<div class="turno-painel">
  <!-- Header do Turno Ativo -->
  <div class="painel-header">
    <div class="turno-badge">
      <span class="badge-dot"></span>
      TURNO ATIVO
    </div>
    <span class="tempo-decorrido">{{ tempoDecorrido() }}</span>
  </div>

  <!-- Info do Turno -->
  <div class="turno-info">
    <div class="info-row">
      <div class="info-item">
        <span class="info-label">Operador</span>
        <span class="info-value">{{ registro().operador }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Turno</span>
        <span class="info-value">{{ registro().turno }}</span>
      </div>
    </div>
    <div class="info-row">
      <div class="info-item">
        <span class="info-label">Inicio</span>
        <span class="info-value">{{ registro().horaInicio }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Temp. Inicial</span>
        <span class="info-value">{{ registro().temperaturaInicio }}°C</span>
      </div>
    </div>
  </div>

  <!-- Estatísticas do Turno -->
  @if (estatisticas().totalLeituras > 0) {
    <div class="turno-stats">
      <h4>Leituras do Turno</h4>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-value">{{ estatisticas().totalLeituras }}</span>
          <span class="stat-label">Leituras</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ estatisticas().mediaTemperatura }}°C</span>
          <span class="stat-label">Media</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ estatisticas().minTemperatura }}°C</span>
          <span class="stat-label">Minima</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ estatisticas().maxTemperatura }}°C</span>
          <span class="stat-label">Maxima</span>
        </div>
      </div>
    </div>
  }

  <!-- Lista de Leituras Recentes -->
  @if (registro().leituras && registro().leituras!.length > 0) {
    <div class="leituras-recentes">
      <h4>Ultimas Leituras</h4>
      <div class="leituras-list">
        @for (leitura of registro().leituras!.slice(-5).reverse(); track leitura.id) {
          <div class="leitura-item">
            <span class="leitura-hora">{{ leitura.hora }}</span>
            <span class="leitura-temp">{{ leitura.temperatura }}°C</span>
            @if (leitura.observacao) {
              <span class="leitura-obs">{{ leitura.observacao }}</span>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Formulário de Nova Leitura -->
  @if (mostrarFormLeitura()) {
    <div class="form-leitura">
      <h4>Registrar Leitura</h4>
      <form [formGroup]="formLeitura" (ngSubmit)="registrarLeitura()">
        <div class="form-field">
          <label for="temperatura">Temperatura (°C)</label>
          <input
            type="number"
            id="temperatura"
            formControlName="temperatura"
            min="0"
            max="2000"
            placeholder="0" />
        </div>

        <div class="form-field">
          <label for="observacao">Observacao (opcional)</label>
          <input
            type="text"
            id="observacao"
            formControlName="observacao"
            placeholder="Ex: Estavel, Ajuste realizado..." />
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="cancelarLeitura()">Cancelar</button>
          <button type="submit" class="btn-confirm" [disabled]="formLeitura.invalid || registrando()">
            @if (registrando()) {
              Registrando...
            } @else {
              Registrar
            }
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Ações do Turno -->
  <div class="turno-actions">
    @if (!mostrarFormLeitura()) {
      <button class="btn-leitura" (click)="abrirFormLeitura()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/>
        </svg>
        Registrar Leitura
      </button>
    }

    <button class="btn-finalizar" (click)="onFinalizarTurno()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
      </svg>
      Finalizar Turno
    </button>
  </div>
</div>
