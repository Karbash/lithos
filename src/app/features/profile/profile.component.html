<div class="profile">
  <div class="profile-content">
    <h1>Meu Perfil</h1>

    @if (user()) {
      <!-- Card Principal do Usuario -->
      <div class="user-card">
        <div class="user-header">
          <div class="user-avatar">
            {{ user()!.name.charAt(0) }}
          </div>
          <div class="user-info">
            <h2>{{ user()!.name }}</h2>
            <span class="user-role">{{ getRoleLabel(user()!.role) }}</span>
          </div>
        </div>

        <div class="user-details">
          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-label">Email</span>
              <span class="detail-value">{{ user()!.email }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Cargo</span>
              <span class="detail-value">{{ user()!.cargo || '-' }}</span>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-label">Setor</span>
              <span class="detail-value">{{ user()!.setor || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Admissao</span>
              <span class="detail-value">{{ user()!.dataAdmissao || '-' }}</span>
            </div>
          </div>
        </div>

        <!-- Plantas Vinculadas -->
        <div class="plantas-section">
          <h3>Plantas Vinculadas</h3>
          <div class="plantas-list">
            @for (planta of user()!.plantasVinculadas; track planta) {
              <span class="planta-tag">{{ planta }}</span>
            }
            @if (user()!.plantasVinculadas.length === 0) {
              <span class="empty-text">Nenhuma planta vinculada</span>
            }
          </div>
        </div>

        @if (user()!.turnoPreferencial) {
          <div class="turno-preferencial">
            <span class="pref-label">Turno Preferencial:</span>
            <span class="pref-value">Turno {{ user()!.turnoPreferencial }} ({{ getTurnoLabel(user()!.turnoPreferencial!) }})</span>
          </div>
        }
      </div>

      <!-- Turno Ativo -->
      @if (turnoAtivo()) {
        <div class="turno-ativo-card">
          <div class="turno-header">
            <div class="turno-badge">
              <span class="badge-dot"></span>
              TURNO ATIVO
            </div>
            <span class="turno-tempo">{{ calcularTempoTurno(turnoAtivo()!.horaInicio) }}</span>
          </div>

          <div class="turno-info">
            <div class="turno-forno">
              <span class="forno-label">Forno</span>
              <span class="forno-nome">{{ fornoTurnoAtivo()?.nome || 'Forno ' + turnoAtivo()!.fornoId }}</span>
              @if (fornoTurnoAtivo()) {
                <span class="forno-planta">{{ fornoTurnoAtivo()!.planta }}</span>
              }
            </div>
            <div class="turno-details">
              <div class="turno-detail">
                <span class="label">Turno</span>
                <span class="value">{{ turnoAtivo()!.turno }}</span>
              </div>
              <div class="turno-detail">
                <span class="label">Inicio</span>
                <span class="value">{{ turnoAtivo()!.horaInicio }}</span>
              </div>
              <div class="turno-detail">
                <span class="label">Temp. Inicial</span>
                <span class="value">{{ turnoAtivo()!.temperaturaInicio }}Â°C</span>
              </div>
              @if (turnoAtivo()!.leituras && turnoAtivo()!.leituras!.length > 0) {
                <div class="turno-detail">
                  <span class="label">Leituras</span>
                  <span class="value">{{ turnoAtivo()!.leituras!.length }}</span>
                </div>
              }
            </div>
          </div>

          <button class="btn-ir-forno" (click)="irParaForno(turnoAtivo()!.fornoId)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
            Ir para o Forno
          </button>
        </div>
      }

      <!-- Estatisticas -->
      @if (estatisticas() && user()!.role === 'operador') {
        <div class="stats-card">
          <h3>Minhas Estatisticas</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-number">{{ estatisticas()!.totalTurnos }}</span>
              <span class="stat-label">Total de Turnos</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ estatisticas()!.turnosFechados }}</span>
              <span class="stat-label">Turnos Concluidos</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ estatisticas()!.producaoTotal }} <small>ton</small></span>
              <span class="stat-label">Producao Total</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ estatisticas()!.mediaProducao }} <small>ton</small></span>
              <span class="stat-label">Media por Turno</span>
            </div>
          </div>
        </div>
      }

      <!-- Historico de Turnos -->
      @if (historicoTurnos().length > 0) {
        <div class="historico-card">
          <h3>Historico de Turnos</h3>
          <div class="historico-list">
            @for (turno of historicoTurnos(); track turno.id) {
              <div class="historico-item" [class]="getStatusClass(turno.status)">
                <div class="historico-data">
                  <span class="data">{{ turno.data }}</span>
                  <span class="horario">{{ turno.horaInicio }}@if (turno.horaFim) { - {{ turno.horaFim }}}</span>
                </div>
                <div class="historico-info">
                  <span class="forno">Forno {{ turno.fornoId }}</span>
                  <span class="turno-letra">Turno {{ turno.turno }}</span>
                </div>
                <div class="historico-metricas">
                  @if (turno.producao) {
                    <span class="producao">{{ turno.producao }} ton</span>
                  }
                  <span class="status-badge" [class]="turno.status">
                    {{ turno.status === 'aberto' ? 'Em andamento' : 'Concluido' }}
                  </span>
                </div>
              </div>
            }
          </div>
        </div>
      } @else if (!loading()) {
        <div class="empty-card">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <p>Nenhum turno registrado ainda</p>
        </div>
      }

      @if (loading()) {
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando dados...</p>
        </div>
      }
    }
  </div>
</div>
